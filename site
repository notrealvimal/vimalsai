import React, { useState, useRef, useEffect } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";

export default function ChatScreen() {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");
  const [isTyping, setIsTyping] = useState(false);
  const audioRef = useRef(null);
  const messagesEndRef = useRef(null);

  const fakeAIReply = async (userInput) => {
    // Replace with actual AI call
    await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay
    return `You said: "${userInput}". Ask me something deeper. ðŸ˜‰`;
  };

  const handleSend = async () => {
    if (!input.trim()) return;
    const userText = input.trim();
    const newUserMessage = { type: "user", text: userText };
    setMessages((prevMessages) => [...prevMessages, newUserMessage]);
    setInput("");

    try {
      if (audioRef.current && audioRef.current.readyState >= 2) {
        audioRef.current.currentTime = 0;
        await audioRef.current.play();
      }
    } catch (error) {
      console.error("Audio playback failed:", error);
    }

    setIsTyping(true);
    const aiText = await fakeAIReply(userText);
    const newAIMessage = { type: "ai", text: aiText };
    setTimeout(() => {
      setMessages((prev) => [...prev, newAIMessage]);
      setIsTyping(false);
    }, 1000);
  };

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages, isTyping]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-black via-zinc-900 to-zinc-800 text-white font-sans flex flex-col justify-between px-2 sm:px-4 py-6">
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
          font-family: 'Inter', sans-serif;
        }
        .user-message {
          background: linear-gradient(135deg, #0b84ff 60%, #3b82f6 100%);
          color: white;
          border-radius: 20px 20px 6px 20px;
          margin-left: auto;
          margin-right: 0;
          max-width: 80%;
          box-shadow: 0 2px 12px 0 rgba(11,132,255,0.10);
          animation: popIn 0.18s cubic-bezier(.4,2,.6,1) both;
        }
        .ai-message {
          background: linear-gradient(135deg, #fff 70%, #f3f4f6 100%);
          color: #18181b;
          border-radius: 20px 20px 20px 6px;
          margin-right: auto;
          margin-left: 0;
          max-width: 80%;
          box-shadow: 0 2px 12px 0 rgba(0,0,0,0.07);
          animation: popIn 0.18s cubic-bezier(.4,2,.6,1) both;
        }
        @keyframes popIn {
          0% { transform: scale(0.95) translateY(10px); opacity: 0; }
          100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .chat-divider {
          border: none;
          border-top: 1.5px solid #27272a;
          margin: 24px 0 18px 0;
        }
        .social-link {
          transition: color 0.15s, transform 0.15s;
        }
        .social-link:hover {
          color: #0b84ff;
          transform: translateY(-2px) scale(1.07);
        }
      `}</style>
      <div className="max-w-lg w-full mx-auto">
        <div className="text-center mb-6">
          <h1 className="text-3xl font-semibold tracking-tight drop-shadow-sm">Vimal</h1>
          <p className="text-zinc-400 text-base font-medium">
            Founder &amp; CEO,
            <a href="https://www.trekato.com/" className="social-link inline-block ml-1" target="_blank" rel="noopener noreferrer">
              Trekato
            </a>
          </p>
        </div>

        <div className="bg-zinc-900/90 border border-zinc-800 rounded-3xl p-7 space-y-5 shadow-xl">
          <div className="text-3xl font-medium text-white leading-tight">
            Fuck Portfolio, I built my own AI Clone.
          </div>
          <div className="text-sm text-zinc-400 leading-relaxed">
            Yo, Startup Founders! Wanna ship your product 10x faster than a SpaceX
            launch, design UI so fire it'd make Apple sweat, and bank $1M ARR in 180
            days? Ask my AI clone how I make that magic happen.
            <br />
            <br />
            Dreaming of hosting a sushi tour in Seoul and getting paid? Ask my AI how
            Trekato hooks you up with travelers dying for your local expertise.
            <br />
            <br />
            Just wanna know what's up with me? Ask my AI what games I'm grinding,
            what tunes I'm blasting, what I'm chowing down on, or how I can level up
            your life.
            <br />
            <br />
            <span className="font-semibold text-zinc-200">No login BS, no snooping</span>â€”I can't see your chats. Wanna connect? Ask my AI
            for my number or socials. Have fun.
          </div>
        </div>

        <hr className="chat-divider" />

        <div className="my-6 space-y-3 min-h-[120px]">
          {messages.map((msg, idx) => (
            <div
              key={idx}
              className={`${msg.type === "user" ? "user-message" : "ai-message"} p-3 px-4 w-fit text-base font-normal shadow-sm`}
              aria-live="polite"
            >
              {msg.text}
            </div>
          ))}
          {isTyping && (
            <div className="ai-message p-3 px-4 w-fit italic text-zinc-500 animate-pulse">Thinking like real Vimal...</div>
          )}
          <div ref={messagesEndRef} />
        </div>

        <form
          onSubmit={(e) => {
            e.preventDefault();
            handleSend();
          }}
          className="flex items-center mt-6 gap-2 bg-zinc-900/80 border border-zinc-800 rounded-full px-3 py-2 shadow-lg focus-within:ring-2 focus-within:ring-blue-500"
        >
          <Input
            aria-label="Message input"
            placeholder="Type..."
            className="flex-grow bg-transparent border-none text-white placeholder-zinc-500 focus:ring-0 focus:outline-none text-base px-2"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            autoComplete="off"
          />
          <Button
            type="submit"
            aria-label="Send message"
            className="ml-1 bg-gradient-to-tr from-blue-500 to-blue-400 text-white font-bold rounded-full px-4 py-2 shadow-md hover:from-blue-600 hover:to-blue-500 focus:ring-2 focus:ring-blue-400 focus:outline-none transition-all"
            disabled={!input.trim()}
          >
            <span className="text-lg">âž¤</span>
          </Button>
        </form>

        <div className="mt-10 text-sm text-zinc-500 text-center select-none">
          <div className="flex justify-center gap-5 mb-2">
            <a href="mailto:vimalsreal@gmail.com" className="social-link">Email</a>
            <a href="https://twitter.com/vimalsreal" className="social-link" target="_blank" rel="noopener noreferrer">Twitter</a>
            <a href="https://www.linkedin.com/in/vimalsreal/" className="social-link" target="_blank" rel="noopener noreferrer">LinkedIn</a>
            <a href="https://www.instagram.com/vimalsreal/" className="social-link" target="_blank" rel="noopener noreferrer">Instagram</a>
          </div>
          <div className="text-xs text-zinc-600">Â©2025, Vimalsreal</div>
        </div>
      </div>
      <audio ref={audioRef} src="/sounds/message-sent.mp3" preload="auto" />
    </div>
  );
}



